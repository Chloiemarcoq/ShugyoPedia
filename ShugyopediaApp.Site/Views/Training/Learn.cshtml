@using ShugyopediaApp.Services.ServiceModels;
@{
    ViewData["Title"] = "Shugyopedia";
}
@model LearnTrainingViewModel
@await Component.InvokeAsync("TrainingCategorySidebar")
<main class="main" style="margin-top: 170px;">
    <div class="pos-img">
        <img src="~/img/bg-shape1.png" alt="HTML tutorial" class="w-100" />
    </div>
    <div class="container my-4">
        <div class="row">
            @* Video Topic Resource *@
            <div class="col-8">
                @*<div class="video-container paused shadow" data-volume-level="high">
                    <div class="video-controls-container">
                        <div class="timeline-container">
                            <div class="timeline">
                                <div class="thumb-indicator"></div>
                            </div>
                        </div>
                        <div class="controls">
                            <button class="play-pause-btn">
                                <svg class="play-icon" viewBox="0 0 24 24">
                                    <path fill="currentColor" d="M8,5.14V19.14L19,12.14L8,5.14Z" />
                                </svg>
                                <svg class="pause-icon" viewBox="0 0 24 24">
                                    <path fill="currentColor" d="M14,19H18V5H14M6,19H10V5H6V19Z" />
                                </svg>
                            </button>
                            <div class="volume-container">
                                <button class="mute-btn">
                                    <svg class="volume-high-icon" viewBox="0 0 24 24">
                                        <path fill="currentColor"
                                              d="M14,3.23V5.29C16.89,6.15 19,8.83 19,12C19,15.17 16.89,17.84 14,18.7V20.77C18,19.86 21,16.28 21,12C21,7.72 18,4.14 14,3.23M16.5,12C16.5,10.23 15.5,8.71 14,7.97V16C15.5,15.29 16.5,13.76 16.5,12M3,9V15H7L12,20V4L7,9H3Z" />
                                    </svg>
                                    <svg class="volume-low-icon" viewBox="0 0 24 24">
                                        <path fill="currentColor"
                                              d="M5,9V15H9L14,20V4L9,9M18.5,12C18.5,10.23 17.5,8.71 16,7.97V16C17.5,15.29 18.5,13.76 18.5,12Z" />
                                    </svg>
                                    <svg class="volume-muted-icon" viewBox="0 0 24 24">
                                        <path fill="currentColor"
                                              d="M12,4L9.91,6.09L12,8.18M4.27,3L3,4.27L7.73,9H3V15H7L12,20V13.27L16.25,17.53C15.58,18.04 14.83,18.46 14,18.7V20.77C15.38,20.45 16.63,19.82 17.68,18.96L19.73,21L21,19.73L12,10.73M19,12C19,12.94 18.8,13.82 18.46,14.64L19.97,16.15C20.62,14.91 21,13.5 21,12C21,7.72 18,4.14 14,3.23V5.29C16.89,6.15 19,8.83 19,12M16.5,12C16.5,10.23 15.5,8.71 14,7.97V10.18L16.45,12.63C16.5,12.43 16.5,12.21 16.5,12Z" />
                                    </svg>
                                </button>
                                <input class="volume-slider" type="range" min="0" max="1" step="any" value="1">
                            </div>
                            <div class="duration-container">
                                <div class="current-time">0:00</div>
                                <div class="total-time"></div>
                            </div>
                            <button class="captions-btn">
                                <svg viewBox="0 0 24 24">
                                    <path fill="currentColor"
                                          d="M18,11H16.5V10.5H14.5V13.5H16.5V13H18V14A1,1 0 0,1 17,15H14A1,1 0 0,1 13,14V10A1,1 0 0,1 14,9H17A1,1 0 0,1 18,10M11,11H9.5V10.5H7.5V13.5H9.5V13H11V14A1,1 0 0,1 10,15H7A1,1 0 0,1 6,14V10A1,1 0 0,1 7,9H10A1,1 0 0,1 11,10M19,4H5C3.89,4 3,4.89 3,6V18A2,2 0 0,0 5,20H19A2,2 0 0,0 21,18V6C21,4.89 20.1,4 19,4Z" />
                                </svg>
                            </button>
                            <button class="speed-btn wide-btn">
                                1x
                            </button>
                            <button class="mini-player-btn">
                                <svg viewBox="0 0 24 24">
                                    <path fill="currentColor"
                                          d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14zm-10-7h9v6h-9z" />
                                </svg>
                            </button>
                            <button class="theater-btn">
                                <svg class="tall" viewBox="0 0 24 24">
                                    <path fill="currentColor"
                                          d="M19 6H5c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 10H5V8h14v8z" />
                                </svg>
                                <svg class="wide" viewBox="0 0 24 24">
                                    <path fill="currentColor"
                                          d="M19 7H5c-1.1 0-2 .9-2 2v6c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2zm0 8H5V9h14v6z" />
                                </svg>
                            </button>
                            <button class="full-screen-btn">
                                <svg class="open" viewBox="0 0 24 24">
                                    <path fill="currentColor"
                                          d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z" />
                                </svg>
                                <svg class="close" viewBox="0 0 24 24">
                                    <path fill="currentColor"
                                          d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z" />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <video src="~/video/HTML Basics.mp4">
                        <track kind="captions" srclang="en" src="">
                    </video>
                </div>*@
                <div id="adobe-dc-view"></div>
            </div>
            @* Topics *@
            <div class="col-4">
                <div class="card" style="height: 330px;">
                    <div class="card-header">
                        <div class="d-flex justify-content-center align-items-center">
                            <p class="fs-3 m-0">@Model.Topics.Count @((Model.Topics.Count >= 1) ? "Lesson" : "Lessons")</p>
                        </div>
                    </div>
                    <div class="card-body overflow-y-scroll">
                        <p class="card-text">
                            <ol>
                                @foreach (var topic in Model.Topics)
                                {
                                    <li class="fs-4">@topic.TopicName</li>                                    
                                }
                            </ol>
                        </p>
                    </div>
                </div>
            </div>
            <ul class="nav-tabs nav-tabs-bordered d-flex mt-5" id="tab" role="tablist" style="list-style: none;">
                <li class="nav-item flex-fill" role="presentation">
                    <button class="nav-link w-100 active" id="home-tab" data-bs-toggle="tab"
                            data-bs-target="#details" type="button" role="tab">
                        Details
                    </button>
                </li>
                <li class="nav-item flex-fill" role="presentation">
                    <button class="nav-link w-100" id="profile-tab" data-bs-toggle="tab" data-bs-target="#reviews"
                            type="button" role="tab">
                        Reviews
                    </button>
                </li>
                <li class="nav-item flex-fill" role="presentation">
                    <button class="nav-link w-100" id="contact-tab" data-bs-toggle="tab" data-bs-target="#resources"
                            type="button" role="tab">
                        Resources
                    </button>
                </li>
            </ul>
            
            <div class="tab-content pt-2" id="tab">
                @* Details *@
                <div class="tab-pane fade show active" id="details" role="tabpanel">
                    <h2>@Model.TrainingName</h2>
                    <p class="fs-6 m-0">@Model.TrainingDescription</p>
                    <div class="fs-6 mt-4" id="video-details">
                        <p class="m-0"><span class="fw-bold">Created By:</span> @Model.CreatedBy</p>
                        <p class="m-0"><span class="fw-bold">Last Updated:</span> @Model.UpdatedTime</p>
                        <p class="m-0"><span class="fw-bold">Category:</span> @Model.CategoryName<p>
                    </div>
                </div>
                @* Reviews *@
                <div class="tab-pane fade" id="reviews" role="tabpanel">
                    <h3>Training Feedback</h3>
                    <div class="row">
                        <div class="col-3">
                            <div class="d-flex flex-column align-items-center justify-content-center lh-1 mt-4">
                                <p class="fs-4 m-0">@Model.RateAverage</p>
                                <p class="fs-4 m-0">@{RenderStars(Model.RateAverage);}</p>
                                <p class="fs-4 m-0">Rating</p>
                            </div>
                        </div>                        
                    </div>
                    <hr>
                    <!-- Leave a Rating Section -->
                    <h3>Leave a Rating</h3>
                    <form asp-action="AddRating" asp-controller="Rating" method="POST">
                        <input type="hidden" value="@Model.TrainingId" asp-for="TrainingId" />
                        <input type="hidden" value="@Model.TrainingName" asp-for="TrainingName" />
                        <div class="row">
                            <div class="col-6">
                                <div class="rating p-0">
                                    <input type="radio" id="star5" name="rate" value="5" />
                                    <label for="star5" title="text">5 stars</label>

                                    <input type="radio" id="star4" name="rate" value="4" />
                                    <label for="star4" title="text">4 stars</label>

                                    <input type="radio" id="star3" name="rate" value="3" />
                                    <label for="star3" title="text">3 stars</label>

                                    <input type="radio" id="star2" name="rate" value="2" />
                                    <label for="star2" title="text">2 stars</label>

                                    <input type="radio" id="star1" name="rate" value="1" />
                                    <label for="star1" title="text">1 star</label>

                                </div>
                            </div>
                        </div>
                        <div class="row my-3">
                            <div class="col-6">
                                <label for="email">Email</label>
                                <input type="email" name="email" id="email" class="form-control" placeholder="Email" autocomplete="off">
                            </div>
                            <div class="col-6">
                                <label for="name">Display Name</label>
                                <input type="text" name="name" id="name" class="form-control" placeholder="Display name" autocomplete="off">
                            </div>
                        </div>
                        <textarea name="review" id="review" class="form-control h-25 my-3"
                                  placeholder="Share your thoughts..."></textarea>
                        <button type="submit" class="btn btn-primary">SUBMIT</button>
                    </form>
                    <hr>
                    <!-- User Reviews Section -->
                    <h3>User Reviews</h3>
                    @foreach (var rating in Model.Ratings)
                    {
                        <div class="card my-3">
                            <div class="card-body p-2">
                                <div class="d-flex">
                                    <div class="rounded-img">
                                        <img src="https://ui-avatars.com/api/?name=@(rating.RaterName)" alt="">
                                    </div>
                                    <div class="ms-3">
                                        <p class="fs-5 m-0 fw-bold">@rating.RaterName</p>
                                        <p class="fs-5 m-0">@{RenderStars(rating.Rate);}</p>
                                    </div>
                                </div>
                                <div class="my-3">
                                    <p class="fs-6 read-more-content">@rating.RatingReview
                                    </p><span class="read-more-show">Read More</span>

                                    <span class="read-more-hide">Show Less</span>
                                </div>
                            </div>
                        </div>
                    }
                </div>
                @* Resources *@
                <div class="tab-pane fade" id="resources" role="tabpanel">                    
                        <div class="d-flex align-items-center justify-content-between">
                            <div class="d-flex align-items-center">
                                <select name="filter" id="filter" class="form-select w-25 me-2">
                                    <option value="all">All</option>
                                    <option value="video">Video</option>
                                    <option value="file">File</option>
                                </select>
                                <div class="input-group w-75 my-3">
                                    <input type="text" name="search" id="search" class="form-control" placeholder="Search...">
                                    <button type="submit" class="btn btn-primary">Search</button>
                                </div>
                            </div>
                            
                        </div>
                        <form asp-action="DownloadResources" asp-controller="Training" method="post">
                            <button type="submit" class="btn btn-primary">Download Selected Files</button>
                            <div class="card">
                                <div class="card-body">
                                    <table class="table table-striped table-borderless text-center" id="datatable">
                                        <thead>
                                            <tr>
                                                <th>
                                                    <input type="checkbox" id="select-all" class="form-check-input"> 
                                                    Title
                                                </th>
                                                <th>Document Tag</th>
                                                <th>Download</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @foreach (var topic in Model.Topics)
                                            {
                                                <tr>
                                                    <td>
                                                        <input type="checkbox" value="@topic.ResourceFile" name="checkboxes" class="form-check-input"> 
                                                        @topic.TopicName
                                                    </td>
                                                <td>@topic.ResourceFileType</td>
                                                <td>
                                                    <a id="downloadButton" asp-action="DownloadResource" asp-controller="Training" asp-route-fileUrl="@topic.ResourceFile" class="btn btn-primary" download>Download</a>
                                                </td>
                                            </tr>
                                        }                                
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</main>
@section scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const showButtons = document.querySelectorAll('.read-more-show');
            const hideButtons = document.querySelectorAll('.read-more-hide');
            const contents = document.querySelectorAll('.read-more-content');

            for (let i = 0; i < showButtons.length; i++) {
                const showButton = showButtons[i];
                const hideButton = hideButtons[i];
                const content = contents[i];

                showButton.addEventListener('click', function () {
                    content.style.webkitLineClamp = 'unset';
                    showButton.style.display = 'none';
                    hideButton.style.display = 'inline';
                });

                hideButton.addEventListener('click', function () {
                    content.style.webkitLineClamp = '2';
                    showButton.style.display = 'inline';
                    hideButton.style.display = 'none';
                });
            }
        });
        document.getElementById("downloadButton").addEventListener("click", function (event) {
            event.preventDefault(); 
            var downloadUrl = this.getAttribute("href");
            window.location.href = downloadUrl;
        });
        document.getElementById("select-all").addEventListener("change", function () {
            var checkboxes = document.getElementsByName("checkboxes");
            for (var i = 0; i < checkboxes.length; i++) {
                checkboxes[i].checked = this.checked;
            }
        });

        var checkboxes = document.getElementsByName("checkboxes");
        for (var i = 0; i < checkboxes.length; i++) {
            checkboxes[i].addEventListener("change", function () {
                var selectAllCheckbox = document.getElementById("select-all");
                var allChecked = true;
                for (var j = 0; j < checkboxes.length; j++) {
                    if (!checkboxes[j].checked) {
                        allChecked = false;
                        break;
                    }
                }
                selectAllCheckbox.checked = allChecked;
            });
        }
        document.addEventListener("adobe_dc_view_sdk.ready", function () {
            var adobeDCView = new AdobeDC.View({ clientId: "2502340015ec47698a1885a2918f6823", divId: "adobe-dc-view" });
            adobeDCView.previewFile(
                {
                    content: { location: { url: "D: \Coding\LocalServer\shugyopediaResources\topic_resources\CenterMEDiv.pdf" } },
                    metaData: { fileName: "CenterMEDiv.pdf" }
                });
        });
    </script>
}
@functions {
    void RenderStars(double rateAverage)
    {
        int fullStars = (int)rateAverage;
        bool hasHalfStar = rateAverage - fullStars >= 0.5;

        for (int i = 0; i < fullStars; i++)
        {
            <i class="fa-solid fa-star" style="color: #EAC612;"></i>
        }

        if (hasHalfStar)
        {
            <i class="fa-solid fa-star-half" style="color: #EAC612;"></i>
        }

        for (int i = fullStars + (hasHalfStar ? 1 : 0); i < 5; i++)
        {
            <i class="fa-regular fa-star" style="color: #EAC612;"></i>
        }
    }
}